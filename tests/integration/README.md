# フロントエンドとバックエンドの統合テスト

このディレクトリには、建設資材ECサイトのフロントエンドとバックエンドの連携を検証するための統合テストが含まれています。

## テスト戦略

統合テストには以下の2つのアプローチがあります：

1. **シンプルテスト**（`product.simple.test.ts`）：
   - 最小限の設定で商品API機能をテスト
   - 問題切り分けのためのシンプルなテスト環境

2. **包括的テスト**（`product.comprehensive.test.ts`）：
   - より多くのテストケースをカバーした商品API機能テスト
   - シンプルなExpressアプリを直接使用

3. **従来の統合テスト**（`productSearch.test.ts`）：
   - server.tsとの連携を使った完全な統合テスト
   - より複雑な設定だが、実際の環境に近い

## 実行方法

### 前提条件

- Node.jsとnpmがインストールされていること
- プロジェクトの依存関係がインストールされていること（`npm install`）

### 各テストの実行

```bash
# シンプルテストの実行
npm run test:integration:simple

# 包括的テストの実行
npm run test:integration:comprehensive

# 全ての統合テストを実行
npm run test:integration:all

# カバレッジレポート付きで実行
npm run test:integration:report
```

## テスト環境

### モックの仕組み

統合テストでは、以下のコンポーネントがモック化されています：

- **APIルート**：`routesMock.ts`で定義された商品、カテゴリなどのエンドポイント
- **APIクライアント**：`apiClientMock.ts`でフロントエンドのAPI呼び出しをシミュレート
- **エラーハンドリング**：`utilsMock.ts`でAPIエラー処理をモック化

### インメモリデータベース

テストでは`mongodb-memory-server`を使用して、インメモリのMongoDBインスタンスを実行します。これにより、実際のデータベースに影響を与えることなくテストが可能です。

## テストケース

主なテストケースとして以下が含まれます：

1. **基本的な商品検索**：商品名検索、カテゴリフィルタリング
2. **価格による絞り込み**：価格範囲検索
3. **ソート機能**：価格の昇順・降順ソート
4. **特定条件検索**：SKU検索、メーカー検索
5. **複合条件検索**：複数のフィルターを組み合わせた検索

## トラブルシューティング

テスト実行時の一般的な問題：

1. **404エラー**：APIエンドポイントが正しく登録されていない場合に発生。モックルーターの設定を確認してください。
2. **型エラー**：TypeScriptの型不一致。適切に型キャストを行うか、型定義を修正してください。
3. **テスト環境変数**：環境変数を適切に設定（`.env.test`）

## 貢献

テストケースの追加や改善を行う場合は、以下のポイントを考慮してください：

1. シンプルな単一責任テストを優先
2. 複雑なセットアップは避け、必要最小限のモックを使用
3. テスト名と処理内容を明確にして、メンテナンスしやすくする 